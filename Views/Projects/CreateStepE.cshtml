@model smoothie.ViewModel.ProjectWizardViewModel

@{
    ViewData["Title"] = "Create Project - Step 5";
}

<div class="container mt-4">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <h2>Create New Project</h2>
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h4 class="mb-0">Upload Documents (Optional)</h4>
                </div>
                <div class="card-body">
                    <!-- Summary Section -->
                    <div class="alert alert-secondary mb-4">
                        <h5 class="alert-heading">Project Summary</h5>
                        <hr>
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Name:</strong> @Model.Name</p>
                                <p><strong>Start Date:</strong> @Model.StartDate?.ToString("dd/MM/yyyy")</p>
                                <p><strong>End Date:</strong> @Model.EndDate?.ToString("dd/MM/yyyy")</p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Priority:</strong> @Model.Priority</p>
                                <p><strong>Team Members:</strong> @(Model.EmployeeIds?.Count ?? 0) selected</p>
                            </div>
                        </div>
                    </div>

                    <form asp-action="CreateStepE" method="post" enctype="multipart/form-data">
                        <div class="mb-3">
                            <label for="files" class="form-label">Upload Project Documents</label>
                            <input type="file" 
                                   name="files" 
                                   id="files" 
                                   class="form-control" 
                                   multiple 
                                   accept=".pdf,.doc,.docx,.xls,.xlsx,.txt,.png,.jpg,.jpeg" />
                            <small class="form-text text-muted">
                                You can select multiple files. Accepted formats: PDF, Word, Excel, Text, Images
                            </small>
                        </div>

                        <div id="fileList" class="mb-3"></div>

                        <div class="d-flex justify-content-between mt-4">
                            <button type="submit" name="action" value="back" class="btn btn-secondary">Back</button>
                            <div>
                                <a asp-action="Index" class="btn btn-outline-secondary me-2">Cancel</a>
                                <button type="submit" name="action" value="finish" class="btn btn-success">
                                    <i class="bi bi-check-circle"></i> Finish & Create Project
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const fileInput = document.getElementById('files');
            const fileList = document.getElementById('fileList');
            
            fileInput.addEventListener('change', function() {
                fileList.innerHTML = '';
                
                if (this.files.length > 0) {
                    const listGroup = document.createElement('div');
                    listGroup.className = 'list-group';
                    
                    const header = document.createElement('div');
                    header.className = 'list-group-item active';
                    header.textContent = `Selected Files (${this.files.length})`;
                    listGroup.appendChild(header);
                    
                    Array.from(this.files).forEach((file, index) => {
                        const item = document.createElement('div');
                        item.className = 'list-group-item d-flex justify-content-between align-items-center';
                        
                        const fileInfo = document.createElement('div');
                        fileInfo.innerHTML = `
                            <strong>${file.name}</strong>
                            <br>
                            <small class="text-muted">${formatFileSize(file.size)}</small>
                        `;
                        
                        const badge = document.createElement('span');
                        badge.className = 'badge bg-primary rounded-pill';
                        badge.textContent = getFileExtension(file.name).toUpperCase();
                        
                        item.appendChild(fileInfo);
                        item.appendChild(badge);
                        listGroup.appendChild(item);
                    });
                    
                    fileList.appendChild(listGroup);
                }
            });
            
            function formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
            }
            
            function getFileExtension(filename) {
                return filename.slice((filename.lastIndexOf('.') - 1 >>> 0) + 2);
            }
        });
    </script>
}
